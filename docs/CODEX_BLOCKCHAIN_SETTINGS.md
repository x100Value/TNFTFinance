# Codex Blockchain Settings (Project Rules)

Date added: 2026-02-20  
Applies to: TNFTFi and any blockchain-related tasks in this workspace.

## Golden Rules
- 1. Безопасность протокола превыше всего.
- 2. Все округления в пользу протокола.
- 3. Если вижу уязвимость, я обязан явно помечать ее как `CRITICAL` / `HIGH` / `MEDIUM`.
- 4. Если ты пропускаешь уязвимость, я обязан отдельно и заметно указать на нее.
- 5. Любая неоднозначность в экономике/учете считается блокером до уточнения.
- 6. В mainnet нельзя идти без тестов, инвариантов и внешнего аудита.
- 7. Oracle-логика должна быть fail-closed: нет валидной цены = нет новых займов.
- 8. Доступ к риск-параметрам только через multisig + timelock.
- 9. Запрещено смешивать риски разных коллекций в одном общем пуле (только isolated pools).
- 10. Любые изменения risk-параметров должны быть версионированы и журналироваться.
- 11. Любая привилегированная транзакция должна иметь человекочитаемый decode и двойную независимую проверку перед подписью.
- 12. Любая интеграция, где есть `call/approve/permit`, должна иметь allowlist целевых контрактов и функций.
- 13. Unlimited approvals запрещены по умолчанию; лимиты и срок действия approvals обязательны.
- 14. Приватные ключи/seed не хранятся на обычных рабочих устройствах; только hardware wallet/HSM + отдельные роли.
- 15. Для критичных действий нужен принцип `2-person rule` и time delay.
- 16. Для каждого критичного контракта обязателен аварийный pause и runbook реагирования.
- 17. Любой код, сгенерированный ИИ, считается непроверенным до ручного security-review + тестов.
- 18. Нельзя деплоить или менять risk-параметры без dry-run на testnet и checklist-подписи.
- 19. Любое внешнее dependency (npm, SDK, скрипты) фиксируется по версии и проходит integrity-проверку.
- 20. Мониторинг on-chain аномалий (outflow spikes, unusual approvals) с авто-алертом обязателен.

## Incident-Based Lessons (Recent)
- LI.FI (2024-07): ошибка в новом контракте + возможность неавторизованного вызова привела к потерям; вывод — жёсткий контроль call-path и approvals.
- Radiant Capital (2024-10): компрометация устройств/подписантов multisig; вывод — изоляция ключей, независимая верификация payload, оп-процедуры для signers.
- Prisma Finance (2024-03): уязвимость в механике liquidation; вывод — инварианты ликвидации и тесты на edge-cases до релиза.
- Safe ecosystem / Bybit (2025-02): целевая атака на workflow подписантов и UI-представление данных; вывод — доверять только независимому decode и out-of-band проверке.

## Reporting Format I will use
- For vulnerabilities:
  - `CRITICAL`: прямой риск потери средств/инсолвентности.
  - `HIGH`: существенный риск убытков или обхода контроля.
  - `MEDIUM`: риск некорректной логики/учета без немедленной катастрофы.
- For each finding I will include:
  - What can break
  - Attack/failure scenario
  - Minimal safe fix
